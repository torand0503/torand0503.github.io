<!DOCTYPE html>
<!-- saved from url=(0038)https://cssgrid-generator.netlify.app/ -->
<html lang="en">

<head>
  <link href="./CSS Grid Generator_files/app.2225ef53.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <style>
    .gridCell {
      display: flex;
      flex-direction: column;
      height: 1fr;
      width: 1fr;
      position: absolute;
      justify-content: center;
      align-items: center;
      align-content: stretch;
    }

    .gridCell > .settings {
      display: block;
      align-items: center;
      flex: 0;
      flex-grow: 0;
      flex-shrink: 1;
      flex-basis: auto;
      align-self: auto;
    }

    /* The Modal (background) */
.modal {
  display: none; /* Hidden by default */
  position: fixed; /* Stay in place */
  z-index: 1; /* Sit on top */
  left: 0;
  top: 0;
  width: 100%; /* Full width */
  height: 100%; /* Full height */
  overflow: auto; /* Enable scroll if needed */
  background-color: rgb(0,0,0); /* Fallback color */
  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}

/* Modal Content/Box */
.modal-content {
  background-color: #492727;
  margin: 10% auto; /* 15% from the top and centered */
  padding: 20px;
  border: 1px solid #888;
  width: 50%; /* Could be more or less, depending on screen size */
  height: 50%;
  color: black;
}

.modal-content > p {
  color: white;
  font-size: larger;
  font-family: monospace;
}

/* The Close Button */
.close {
  color: #aaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.close:hover,
.close:focus {
  color: black;
  text-decoration: none;
  cursor: pointer;
}
  </style>
</head>

<body>
  <!-- The Modal -->
<div id="myModal" class="modal">

  <!-- Modal content -->
  <div class="modal-content">
    <span class="close">&times;</span>
    <p>Genererad URL</p>
    <button id="buttonCopyToClipboard">Kopiera till urklipp</button>
  </div>

</div>
  <div id="app">
    <div class="container">
      <div class="main">
        <div id="colunits"
          style="grid-template-columns: 1fr; grid-template-rows: 50px; gap: 0px;">
          <div><input
              class="columnWidth" value="100%"></input></div>
          </div>
        <div id="rowunits"
          style="grid-template-columns: 50px; grid-template-rows: 1fr; gap: 0px;">
          <div><input class="rowHeight" value="100%"></input></div>
        </div>
        <div id="gridcontainer">
          <div id="grid"
            style=" gap: 0px;">
          </div>
        </div>
      </div>
      <div class="aside">
        <fieldset><label for="nrOfColumns">Antal kolumner</label><input 
            id="nrOfColumns" type="number" min="1" max="12" value="1"></fieldset>
        <fieldset><label  for="nrOfRows">Antal rader</label><input 
            id="nrOfRows" type="number" min="1" max="12" value="1"></fieldset>
        <button id="buttonGenerateUrl">Generera url</button><br />
        <button id="buttonSaveLayout">Spara layout</button><br />
        <button id="buttonReset">Återställ</button><!---->
      </div>
    </div>
  </div>
</body>
<script>
  $(function() {

    $("span").click(function() {
      $("#myModal").css("display", "none")
    })

    $("#buttonGenerateUrl").click(function() {
      let nrOfRows = grid.nrOfRows();
      let nrOfColumns = grid.nrOfColumns();

      let gridOutput = []

      for ( var i = 0; i < nrOfRows; i++) {
        gridOutput.push([])
      }

      for ( var i = 1; i < nrOfRows + 1; i++) {
        for ( var j = 1; j < nrOfColumns + 1; j++) {
          let gridCell = $("#grid").find(".gridCell").filter(function() {

            return $(this).css("grid-area").startsWith(`${i} / ${j}`)
          }).first();

          gridOutput[i-1][j-1] = gridCell;
        }
      }

      generateUrl(gridOutput);
    })

    const generateGooglePresentationUrl = (inputs) => {
      let publishUrl = $(inputs[0]).val()
      let delayms    = $(inputs[1]).val()

      let outputUrl = `${publishUrl}?start=true&loop=true&delayms=${delayms}&rm=minimal`

      return outputUrl
    }

    const generateVästtrafikUrl = (inputs) => {
      let västtrafikUrl = "https://avgangstavla.vasttrafik.se/?source=vasttrafikse-depatureboardlinkgenerator"

      let stop1 = $(inputs[0]).val()
      let stop2 = $(inputs[1]).val()

      let outputUrl = `${västtrafikUrl}&stopAreaGid=${stop1}&stopAreaGid=${stop2}`

      return outputUrl
    }

    const generateUrlParam = (cell) => {
      let selectChoice = $(cell).find(".selectChoice")

      let selectValue = $(selectChoice).val()

      if (selectValue == "Google Presentation")
        return generateGooglePresentationUrl($(cell).find("input"))
      else if (selectValue == "Västtrafik")
        return generateVästtrafikUrl($(cell).find("input"))
      else if (selectValue == "Hemsida") {
        return $(cell).find("input").first().val()
      }
    }

    const showUrl = (url) => {
      $("#buttonCopyToClipboard").click(function () {
        navigator.clipboard.writeText(url);
      })

      $("#myModal").css("display", "block");
    }

    const generateUrl = (gridOutput) => {
      let baseURL = new URL("file:///Users/tori/Library/CloudStorage/GoogleDrive-torbjorn.andersson@educ.goteborg.se/Other%20computers/Min%20laptop%20(1)/vasttrafik%20zoom/vasttrafik.html")

      gridOutput = gridOutput.map(row => {
        return row.map(cell => generateUrlParam(cell))
      })

      let [ul, ur] = gridOutput[0] || []
      let [ll, lr] = gridOutput[1] || []

      let params = {ul, ur, ll, lr}

      let sizes = {
        uh: $(rowUnits.getRowUnit(0)).val(),
        lh: $(rowUnits.getRowUnit(1)).val(),
        lw: $(colUnits.getColUnit(0)).val(),
        rw: $(colUnits.getColUnit(1)).val(),
      }

      console.log(sizes)

      console.log(colUnits.getColUnit(1))

      sizes = Object.fromEntries(Object.entries(sizes).filter(([k, v]) => v))

      params = Object.fromEntries(Object.entries(params).filter(([k, v]) => v))

      params = Object.assign(params, sizes)

      params = Object.fromEntries(Object.entries(params).filter(([k, v]) => v))

      baseURL.search = new URLSearchParams(params)

      let outputUrl = baseURL.toString();

      showUrl(outputUrl)
    }

    const pasteGooglePresentation = (cellChoice, pasteValue) => {

      let url = pasteValue.slice(pasteValue.indexOf("https"), pasteValue.indexOf('"', pasteValue.indexOf("https") + 1))
      
      let embedUrl = url.slice(0, url.indexOf("?"))
      let params = url.slice(url.indexOf("?"))
      
      const urlParams = new URLSearchParams(params);

      let inputs = $(cellChoice).next(".optionParams").find("input")

      $(inputs[0]).val(embedUrl)
      $(inputs[1]).val(urlParams.get("delayms"))
    }

    const pasteVästtrafikPresentation = (cellChoice, pasteValue) => {
      let params = pasteValue.slice(pasteValue.indexOf("?"))

      const urlParams = new URLSearchParams(params);

      let stopAreaGids = []

      for ( let [urlParam, stopAreaGid] of urlParams) {
        if (urlParam == "stopAreaGid")
          stopAreaGids.push(stopAreaGid)
      }

      let inputs = $(cellChoice).next(".optionParams").find("input")

      stopAreaGids.forEach((stopAreaGid, index) => {
        console.log(inputs[index])
        console.log(stopAreaGid)

        $(inputs[index]).val(stopAreaGid);
      })
    }
    
    const parsePaste = (input) => {
      let cellChoice = $(input).parent().parent().prev(".selectChoice")

      let pasteValue = $(input).val();

      let cellValue = $(cellChoice).val()

      if (cellValue == "Google Presentation")
        pasteGooglePresentation(cellChoice, pasteValue)
      if (cellValue == "Västtrafik")
        pasteVästtrafikPresentation(cellChoice, pasteValue)
    }

    const generateCell = () => {

      let optionParams = {
        "Google Presentation": [
          "Publish URL (embed)",
          "Delay",
        ], "Västtrafik": [
          "Hållplats 1",
          "Hållplats 2"
        ], "Hemsida": [
          "URL"
        ]
      }

      let options = $("<select />").addClass("classic").addClass("selectChoice").append([
        $("<option />").text("Välj alternativ:"),
        $("<option />").text("Google Presentation"),
        $("<option />").text("Västtrafik"),
        $("<option />").text("Hemsida"),
      ])

      $(options).on("change", function() {
        let settings = optionParams[this.value]

        $(options).parent().find("div.optionParams").empty().append(
          settings.map(setting => $("<fieldset />").append([
            `<label for="${setting}">${setting}</label>`,
            $("<input />").on("paste", function() {
              let _this = this;
              setTimeout(function(){
                parsePaste(_this);
              },1);
            })
          ]))
        )
      })
      return $("<div />").addClass("gridCell").append($("<div />").addClass("settings").append([options, $("<div />").addClass("optionParams")]) )
    }

    

    const generateRowSizeElement = () => {
      let rowHeightElement = $("<input />").addClass("rowHeight")

      let divContainer = $("<div />").append(rowHeightElement)

      return divContainer
    }

    const generateColSizeElement = () => {
      return $("<div />").append($("<input />").addClass("columnWidth") )
    }

    let nrOfColumns = document.getElementById("nrOfColumns")
    let nrOfRows    = document.getElementById("nrOfRows")

    let colUnits    = document.getElementById("colunits");
    let rowUnits    = document.getElementById("rowunits");

    rowUnits.nrOfRows = () => {
      console.log($(rowUnits))
      

      return $(rowUnits).css("grid-template-rows").split(" ").length;
    }

    rowUnits.getRowUnit = (index) => {
      return $(rowUnits).find(".rowHeight").eq(index)
    }

    rowUnits.addRowUnit = () => {
      let rowCount = rowUnits.nrOfRows()

      $(rowUnits).css("grid-template-rows", `repeat(${rowCount+1},1fr)`)
      
      let rowSizeElement = generateRowSizeElement();

      $(rowSizeElement).height("1fr").css("grid-area", `${rowCount + 1} / 1` ).appendTo($(rowUnits))

      rowUnits.updateRowSizes();
    }

    rowUnits.popRowUnit = () => {
      let rowCount = rowUnits.nrOfRows()

      $(rowUnits).css("grid-template-rows", `repeat(${rowCount-1},1fr)`)

      $(rowUnits).find("div").get()
      .filter(cell => 
        $(cell).css("grid-row-start") == rowCount.toString()
      )
      .forEach(cell => {
        $(cell).remove();
      })
    }

    rowUnits.updateRowSizes = () => {
      let nrOfRows = rowUnits.nrOfRows();
      
      $(rowUnits).find("input").val(`${(1 / nrOfRows) * 100}%`)
    }

    colUnits.nrOfColumns = () => {
      return $(colUnits).css("grid-template-columns").split(" ").length;
    }

    colUnits.getColUnit = (index) => {
      return $(colUnits).find(".columnWidth").eq(index)
    }

    colUnits.addColUnit = () => {
      let colCount = colUnits.nrOfColumns()

      $(colUnits).css("grid-template-columns", `repeat(${colCount+1},1fr)`)
      
      let colSizeElement = generateColSizeElement();

      $(colSizeElement).height("1fr").css("grid-area", `1 / ${colCount + 1}` ).appendTo($(colUnits))

      colUnits.updateColSizes()
    }

    colUnits.popColUnit = () => {
      let colCount = colUnits.nrOfColumns()

      $(colUnits).css("grid-template-columns", `repeat(${colCount-1},1fr)`)

      $(colUnits).find("div").get()
      .filter(cell => 
        $(cell).css("grid-column-start") == colCount.toString()
      )
      .forEach(cell => {
        $(cell).remove();
      })
    }

    colUnits.updateColSizes = () => {
      let nrOfCols = colUnits.nrOfColumns();
      
      $(colUnits).find("input").val(`${(1 / nrOfCols) * 100}%`)
    }

    let buttonGenerateUrl = document.getElementById("generateUrl")
    let buttonSaveLayout  = document.getElementById("saveLayout")
    let buttonReset       = document.getElementById("reset")
    
    let grid     = document.getElementById("grid")

    let initialCell = generateCell();

    $(initialCell).css("grid-area", `1 / 1` ).appendTo($(grid))

    grid.nrOfRows = () => {
      return $(grid).css("grid-template-rows").split(" ").length;
    }

    grid.nrOfColumns = () => {
      return $(grid).css("grid-template-columns").split(" ").length;
    }

    grid.addRow = () => {
      let rowCount = grid.nrOfRows()
      let colCount = grid.nrOfColumns()

      $(grid).css("grid-template-rows", `repeat(${rowCount+1},1fr)`)
      
      for ( var i = 1; i <= colCount; i++) {
        let generatedCell = generateCell();

        $(generatedCell).css("grid-area", `${rowCount + 1} / ${i}` ).appendTo($(grid))
      }

      rowUnits.addRowUnit()
    }

    grid.popRow = () => {
      let rowCount = grid.nrOfRows()

      $(grid).css("grid-template-rows", `repeat(${rowCount-1},1fr)`)

      $(grid).find("div").get()
      .filter(cell => 
        $(cell).css("grid-row-start") == rowCount.toString()
      )
      .forEach(cell => {
        $(cell).remove();
      })

      rowUnits.popRowUnit();
    }

    const addColumn = () => {
      let rowCount = grid.nrOfRows()
      let colCount = grid.nrOfColumns()

      $(grid).css("grid-template-columns", `repeat(${colCount+1},1fr)`)
      
      for ( var i = 1; i <= rowCount; i++) {
        let generatedCell = generateCell();
        
        $(generatedCell).css("grid-area", `${i} / ${colCount + 1}` ).appendTo($(grid))
      }

      colUnits.addColUnit()
    }

    grid.popColumn = () => {
      let colCount = grid.nrOfColumns()

      $(grid).css("grid-template-columns", `repeat(${colCount-1},1fr)`)

      $(grid).find("div").get()
      .filter(cell => 
        $(cell).css("grid-column-start") == colCount.toString()
      )
      .forEach(cell => {
        $(cell).remove();
      })

      colUnits.popColUnit();
    }

    $(nrOfColumns).mouseup(function (event) {
      const gridComputedStyle = window.getComputedStyle(grid);

      const gridColumnCount = gridComputedStyle.getPropertyValue("grid-template-columns").split(" ").length;
      const value = parseInt($(this).val());

      if (value > gridColumnCount) addColumn();
      if (value < gridColumnCount) removeColumn();
    })

    $(nrOfRows).mouseup(function (event) {
      const gridComputedStyle = window.getComputedStyle(grid);

      const gridRowCount = gridComputedStyle.getPropertyValue("grid-template-rows").split(" ").length;
      const value = parseInt($(this).val());

      if (value > gridRowCount) grid.addRow();
      if (value < gridRowCount) grid.popRow();
    })

    const removeRow = () => {
      grid.popRow();
      
    }
    const removeColumn = () => {
      grid.popColumn();
    }
  });
  
</script>
</html>